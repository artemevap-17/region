<html>  
      <head>
          <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
	     <title></title>
	     <script src="jquery.js"></script>
          <link rel="icon" href="/img/fav-miac.png">
     </head>  
     <body>
          <a class="download" id="download" hidden></a>
          <input type="text" class="url" id="url" name="url" hidden>
           <div class="list_regions" id="list_regions" name="list_regions">
               <form method="post" class="regions" id="regions">
                    <table border="0" align="center">
                         <tr>
                              <td align="center" width=200px><b>Наименование ГО/МР</b></td>
                              <td align="center" width=100px><b>Значение</b></td>
                              <td align="center" width=75px><b>Цвет</b></td>
                              <td align="center" width=25px><input class="checker" id="1" type="checkbox"</td>
                              <td width=50px></td>
                              <td align="center" width=200px><b>Наименование ГО/МР</b></td>
                              <td align="center" width=100px><b>Значение</b></td>
                              <td align="center" width=75px><b>Цвет</b></td>
                              <td align="center" width=25px><input class="checker" id="2" type="checkbox"</td>
                              <td width=50px></td>
                              <td align="center" width=200px><b>Наименование ГО/МР</b></td>
                              <td align="center" width=100px><b>Значение</b></td>
                              <td align="center" width=75px><b>Цвет</b></td>
                              <td align="center" width=25px><input class="checker" id="3" type="checkbox"</td>
                         </tr>
                         <tr>
                              <td>1. Агаповский МР</td>
                              <td align="center"><input id="1-2" name="1-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="1-3" name="1-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="1-4" type="checkbox"></td>
                              <td></td>
                              <td>16. Копейский ГО</td>
                              <td align="center"><input id="16-2" name="16-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="16-3" name="16-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="16-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>31. Снежинский ГО</td>
                              <td align="center"><input id="31-2" name="31-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="31-3" name="31-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="31-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>2. Аргаяшский МР</td>
                              <td align="center"><input id="2-2" name="2-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="2-3" name="2-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="2-4" type="checkbox"></td>
                              <td></td>
                              <td>17. Коркинский МР </td>
                              <td align="center"><input id="17-2" name="17-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="17-3" name="17-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="17-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>32. Сосновский МР</td>
                              <td align="center"><input id="32-2" name="32-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="32-3" name="32-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="32-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>3. Ашинский МР</td>
                              <td align="center"><input id="3-2" name="3-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="3-3" name="3-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="3-4" type="checkbox"></td>
                              <td></td>
                              <td>18. Красноармейский МР</td>
                              <td align="center"><input id="18-2" name="18-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="18-3" name="18-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="18-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>33. Трёхгорный ГО</td>
                              <td align="center"><input id="33-2" name="33-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="33-3" name="33-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="33-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>4. Брединский МР</td>
                              <td align="center"><input id="4-2" name="4-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="4-3" name="4-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="4-4" type="checkbox"></td>
                              <td></td>
                              <td>19. Кунашакский МР</td>
                              <td align="center"><input id="19-2" name="19-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="19-3" name="19-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="19-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>34. Троицкий ГО + МР</td>
                              <td align="center"><input id="34-2" name="34-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="34-3" name="34-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="34-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>5. Варненский МР</td>
                              <td align="center"><input id="5-2" name="5-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="5-3" name="5-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="5-4" type="checkbox"></td>
                              <td></td>
                              <td>20. Кусинский МР</td>
                              <td align="center"><input id="20-2" name="20-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="20-3" name="20-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="20-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>35. Увельский МР</td>
                              <td align="center"><input id="35-2" name="35-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="35-3" name="35-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="35-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>6. Верхнеуральский МР</td>
                              <td align="center"><input id="6-2" name="6-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="6-3" name="6-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="6-4" type="checkbox"></td>
                              <td></td>
                              <td>21. Кыштымский ГО</td>
                              <td align="center"><input id="21-2" name="21-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="21-3" name="21-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="21-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>36. Уйский МР</td>
                              <td align="center"><input id="36-2" name="36-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="36-3" name="36-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="36-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>7. Верхнеуфалейский ГО</td>
                              <td align="center"><input id="7-2" name="7-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="7-3" name="7-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="7-4" type="checkbox"></td>
                              <td></td>
                              <td>22. Локомотивный ГО</td>
                              <td align="center"><input id="22-2" name="22-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="22-3" name="22-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="22-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>37. Усть-Катавский ГО</td>
                              <td align="center"><input id="37-2" name="37-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="37-3" name="37-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="37-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>8. Еманжелинский МР</td>
                              <td align="center"><input id="8-2" name="8-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="8-3" name="8-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="8-4" type="checkbox"></td>
                              <td></td>
                              <td>23. Магнитогорский ГО</td>
                              <td align="center"><input id="23-2" name="23-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="23-3" name="23-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="23-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>38. Чебаркульский ГО + МР</td>
                              <td align="center"><input id="38-2" name="38-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="38-3" name="38-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="38-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>9. Еткульский МР</td>
                              <td align="center"><input id="9-2" name="9-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="9-3" name="9-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="9-4" type="checkbox"></td>
                              <td></td>
                              <td>24. Миасский ГО</td>
                              <td align="center"><input id="24-2" name="24-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="24-3" name="24-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="24-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>39. Челябинский ГО</td>
                              <td align="center"><input id="39-2" name="39-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="39-3" name="39-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="39-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>10. Златоустовский ГО</td>
                              <td align="center"><input id="10-2" name="10-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="10-3" name="10-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="10-4" type="checkbox"></td>
                              <td></td>
                              <td>25. Нагайбакский МР</td>
                              <td align="center"><input id="25-2" name="25-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="25-3" name="25-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="25-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>40. Чесменский МР</td>
                              <td align="center"><input id="40-2" name="40-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="40-3" name="40-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="40-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>11. Карабашский ГО</td>
                              <td align="center"><input id="11-2" name="11-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="11-3" name="11-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="11-4" type="checkbox"></td>
                              <td></td>
                              <td>26. Нязепетровский МР</td>
                              <td align="center"><input id="26-2" name="26-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="26-3" name="26-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="26-4" type="checkbox"></td>
                              <td width=50px></td>
                              <td>41. Южноуральский ГО</td>
                              <td align="center"><input id="41-2" name="41-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="41-3" name="41-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="41-4" type="checkbox"></td>
                         </tr>
                         <tr>
                              <td>12. Карталинский МР</td>
                              <td align="center"><input id="12-2" name="12-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="12-3" name="12-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="12-4" type="checkbox"></td>
                              <td></td>
                              <td>27. Озёрский ГО </td>
                              <td align="center"><input id="27-2" name="27-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="27-3" name="27-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="27-4" type="checkbox"></td>
                              <td></td>
                              <td></td>
                              <td ></td>
                              <td></td>
                              <td></td>
                         </tr>
                         <tr>
                              <td>13. Каслинский МР</td>
                              <td align="center"><input id="13-2" name="13-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="13-3" name="13-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="13-4" type="checkbox"></td>
                              <td></td>
                              <td>28. Октябрьский МР</td>
                              <td align="center"><input id="28-2" name="28-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="28-3" name="28-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="28-4" type="checkbox"></td>
                              <td></td>
                              <td></td>
                              <td ></td>
                              <td></td>
                              <td></td>
                         </tr>
                         <tr>
                              <td>14. Катав-Ивановский МР</td>
                              <td align="center"><input id="14-2" name="14-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="14-3" name="14-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="14-4" type="checkbox"></td>
                              <td></td>
                              <td>29. Пластовский МР</td>
                              <td align="center"><input id="29-2" name="29-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="29-3" name="29-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="29-4" type="checkbox"></td>
                              <td></td>
                              <td></td>
                              <td ></td>
                              <td></td>
                              <td></td>
                         </tr>
                         <tr>
                              <td>15. Кизильский МР</td>
                              <td align="center"><input id="15-2" name="15-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="15-3" name="15-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="15-4" type="checkbox"></td>
                              <td></td>
                              <td>30. Саткинский МР</td>
                              <td align="center"><input id="30-2" name="30-2" type="text" size="3" value="0"></td>
                              <td align="center"><input id="30-3" name="30-3" type="color" value="#66ccff"></td>
                              <td align="center"><input id="30-4" type="checkbox"></td>
                              <td></td>
                              <td></td>
                              <td ></td>
                              <td></td>
                              <td></td>
                         </tr>
                         <tr>
                              <td colspan="14" align="right"><input class="get_map" id="get_map" name="get_map" type="button" value="Построить карту"></td>
                         </tr>
                    </table>
               </form>
          </div>
          <div>
               <table border="0" align="center">
                    <tr>
                         <td>
                              <form method="post" class="options" id="options">
                                   <table align="right" border="0">
                                        <tr>
                                             <td><label>Введите текст для заголовка:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input class="header" id="header" type="text"></td>
                                        </tr>
                                        <tr>
                                             <td><label>Выберите цвет заливки:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input class="color" id="color" type="color"></td>
                                        </tr>
                                        <tr>
                                             <td><label>Выберите цвет текста:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input class="text_color" id="text_color" type="color"></td>
                                        </tr>
                                        <tr>
                                             <td><label>Импортировать xlsx файл:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input type="FILE" class="import" id="import" name="import"></td>
                                        </tr>
                                        <tr>
                                             <td><label>Экспортировать xlsx файл:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input type="button" class="export" id="export" name="export" value="Экспортировать xlsx"></td>
                                        </tr>
                                        <tr>
                                             <td><label>Скачать шаблон импорта:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input type="button" class="sample" id="sample" name="sample" value="Скачать шаблон"></td>
                                        </tr>
                                   </table>
                              </form>
                         </td>
                         <td>
                              <form method="post" class="legend" id="legend">
                                   <table align="left" border="0">
                                        <tr>
                                             <td><label>Значение № 1:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input id="legend_color_1" type="color"></td>
                                             <td><input id="legend_text_1" type="text"></td>
                                        </tr>
                                        <tr>
                                             <td><label>Значение № 2:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input id="legend_color_2" type="color"></td>
                                             <td><input id="legend_text_2" type="text"></td>
                                        </tr>
                                        <tr>
                                             <td><label>Значение № 3:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input id="legend_color_3" type="color"></td>
                                             <td><input id="legend_text_3" type="text"></td>
                                        </tr>
                                        <tr>
                                             <td><label>Значение № 4:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input id="legend_color_4" type="color"></td>
                                             <td><input id="legend_text_4" type="text"></td>
                                        </tr>
                                        <tr>
                                             <td><label>Значение № 5:&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
                                             <td><input id="legend_color_5" type="color"></td>
                                             <td><input id="legend_text_5" type="text"></td>
                                        </tr>
                                   </table>
                              </form>
                         </td>
                    </tr>
               </table>
               
          </div>
      </body>  
 </html>

 <script type="text/javascript">
     $(document).ready(function(){
          $("div").on("click", ".get_map", function(){
               document.getElementById("url").value = "map_generation.php";
               $("#regions").submit();
          });

          $("div").on("submit", ".regions", function(event){
               event.preventDefault();
               var regionsData = $('#regions').serializeArray();
               var text_color = $('#options').find('input[id="text_color"]').val();
               regionsData.push({name: 'text_color', value: text_color});
               
               var postData ={};
               $.each(regionsData, function(i, field) {
                    postData[field.name] = field.value;
               });

               $.ajax({  
                    url:"map_generation.php",//document.getElementById("url").value,  
                    type:"POST",
                    data:postData,
                    success:function(data){
                         //console.log(data);
                         document.getElementById('download').href = data;
                         document.getElementById('download').download = data.split('//')[1];
                         document.getElementById('download').click();
                    }
               });
          });

          $("div").on("change", ".checker", function(){
               if(this.id == "1")
               {
                    for(i = 1; i <= 15; i++)
                    {
                         document.getElementById(i + "-4").checked = this.checked;
                    }
               }
               else if(this.id == "2")
               {
                    for(i = 16; i <= 30; i++)
                    {
                         document.getElementById(i + "-4").checked = this.checked;
                    }
               }
               else if(this.id == "3")
               {
                    for(i = 31; i <= 41; i++)
                    {
                         document.getElementById(i + "-4").checked = this.checked;
                    }
               }
          });

          $("div").on("change", ".color", function(){
               for(i = 1; i <= 41; i++)
               {     
                    if(document.getElementById(i + "-4").checked)
                    {
                         document.getElementById(i + "-3").value = this.value;
                    }
               }
          });

          $("div").on("change", ".import", function(event){
               var extension = document.getElementById("import").value.split('.');
               if(extension[1] == "xlsx"){
                    $("#options").submit();
               }else{
                    alert("Не верный формат файла.");
               }
          });

          $("div").on("submit", ".options", function(event){
               event.preventDefault();
               $.ajax({
                    url:"import.php",
                    method:"POST",
                    data:new FormData(this),
                    contentType:false,
                    processData:false,
                    success:function(data){
                         $('#list_regions').html(data);
                    }
               });
          });

          $("div").on("click", ".export", function(){
               document.getElementById("url").value = "export.php";

               $("#regions").submit();
          });

          $("div").on("click", ".sample", function(event){
               event.preventDefault();
               $.ajax({
                    url:"sample.php",
                    success:function(data){
                         document.getElementById('download').href = data;
                         document.getElementById('download').download = data;
                         document.getElementById('download').click();
                    }
               });
          });
     });
 </script>